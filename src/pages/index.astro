---
// Main comparison table page
import '../styles/global.css';
import type { Agent } from '../agents/featureSetSchema';
import { categoryDisplayNames, featureDisplayNames } from '../agents/featureDisplayNames';

// Load all agent feature sets dynamically
const agentModules = import.meta.glob('../agents/*/featureSet.ts', { eager: true });
const agents: Agent[] = Object.values(agentModules).map((module: any) => module.agent);

// Helper function to get status symbol
function getStatusSymbol(status: string): string {
  switch (status) {
    case 'supported':
      return '✓';
    case 'partially-supported':
      return '◐';
    case 'not-supported':
      return '✗';
    default:
      return '';
  }
}

// Helper function to get status class
function getStatusClass(status: string): string {
  switch (status) {
    case 'supported':
      return 'supported';
    case 'partially-supported':
      return 'partially-supported';
    case 'not-supported':
      return 'not-supported';
    default:
      return '';
  }
}

// Define category order and feature order
const categoryOrder: (keyof Agent['features'])[] = ['planning', 'reasoning', 'tests'];
const featureOrder: Record<string, string[]> = {
  planning: ['multi-step-planning', 'plan-editing', 'plan-execution'],
  reasoning: ['explanation-in-natural-language', 'step-by-step-view'],
  tests: ['test-generation', 'integrates-with-ci', 'editor-plugins-available'],
};
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Compare coding agents based on their features and capabilities" />
    <title>Compare coding agents</title>
  </head>
  <body>
    <main>
      <h1>Compare coding agents</h1>
      <p class="subtitle">Compare coding agents based on their features and capabilities</p>
      
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th></th>
              {agents.map((agent) => (
                <th key={agent.id}>{agent.name}</th>
              ))}
            </tr>
          </thead>
          <tbody>
            {categoryOrder.flatMap((categoryKey) => {
              const category = categoryKey as keyof Agent['features'];
              const features = featureOrder[category];
              return [
                <tr class="category-header">
                  <td colspan={agents.length + 1}>{categoryDisplayNames[category]}</td>
                </tr>,
                ...features.map((featureKey) => (
                  <tr key={featureKey}>
                    <td>{featureDisplayNames[featureKey]}</td>
                    {agents.map((agent) => {
                      const status = agent.features[category][featureKey as keyof typeof agent.features[typeof category]];
                      return (
                        <td key={agent.id}>
                          <span class={`symbol ${getStatusClass(status)}`}>
                            {getStatusSymbol(status)}
                          </span>
                        </td>
                      );
                    })}
                  </tr>
                ))
              ];
            })}
          </tbody>
        </table>
      </div>
      
      <div class="legend">
        <p><strong>Legend:</strong></p>
        <ul>
          <li><span class="symbol supported">✓</span> Fully supported</li>
          <li><span class="symbol partially-supported">◐</span> Partially supported</li>
          <li><span class="symbol not-supported">✗</span> Not supported</li>
        </ul>
      </div>
    </main>
  </body>
</html>

